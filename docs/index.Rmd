---
title: "Replication package"
author: "Anne Keller and Richard Torkar"
date: "First version: 2021-03-18. Current version: `r Sys.time()`."
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(cache = TRUE)
```

```{r setup2, include=FALSE}
library("openxlsx")
library("brms")
library("here") # make sure Rmd and Rproj root is the same
library("bayesplot")
```

# Introduction

This project is a part of a master thesis in software engineering. 


# Data

```{r}
d <- read.xlsx(here("data/SurveyDaTAV2.xlsx"), colNames = TRUE)
d <- d[complete.cases(d), ]
d <- d[d$Gender!=3,]
d$Age_s <- scale(d$Age)
nrow(d)
```

## Descriptive analysis

```{r}
table(d$Gender)
```

```{r}
summary(d$Age)
```


# Analysis

```{r}
m_c <- brm(
  O_Q8_1_5L ~ Age_s + Gender,
  family = cumulative(),
  data = d
)

m_ac <- brm(
  O_Q8_1_5L ~ Age_s + Gender,
  family = acat(),
  data = d
)

m_sr <- brm(
  O_Q8_1_5L ~ Age_s + Gender,
  family = sratio(),
  data = d
)

loo(m_c, m_ac, m_sr)
```

The above model comparison shows that there is no significant difference between the three models. This leaves us the option to pick a family we are comfortable working with. Since the \textsf{Cumulative} family has solid mathematical foundation we pick that one for our Likert scale outcomes.

```{r}
d$NrOfSub <- d$NrOfSub + 1

m0 <- brm(
  O_Q8_1_5L ~ 1,
  family = cumulative(),
  data = d
)

m1 <- brm(
  O_Q8_1_5L ~ 1 + Age_s,
  family = cumulative(),
  data = d
)

m2 <- brm(
  O_Q8_1_5L ~ 1 + Age_s + Gender,
  family = cumulative(),
  data = d
)


p <- get_prior(Concern ~ 1 + Age_s + Gender + mo(NrOfSub) + mo(DaysAWeek),
  family = cumulative(),
  data = d)

p$prior[1] <- "normal(0,1)"
p$prior[c(11,12)] <- "dirichlet(2)"

m3 <- brm(
  Concern ~ 1 + Age_s + Gender + mo(NrOfSub) + mo(DaysAWeek),
  family = cumulative(),
  prior = p,
  # sample_prior = "only",
  data = d
)

pp_check(m3, type="bars", nsamples = 100)

mcmc_areas(m3, prob = 0.5, prob_outer = 0.95, regex_pars = c("^b_A", "^b_G", "^bsp"))

conditional_effects(m3)

# p <- get_prior(mvbind(Concern,Trust_Family) ~ 1 + Age_s + Gender + mo(NrOfSub) + (1 | c | ID),
#   family = cumulative(),
#   data = d)
# 
# p$prior[1] <- "normal(0,1)"
# p$prior[2] <- "lkj(2)"
# p$prior[c(17,30)] <- "dirichlet(2)"
# 
# 
# m3_mv <- brm(
#   mvbind(Concern,Trust_Family) ~ 1 + Age_s + Gender + mo(NrOfSub) + (1 | c | ID),
#   family = cumulative(),
#   prior = p,
#   # sample_prior = "only",
#   data = d
# )
# 
# pp_check(m3_mv, type="bars", nsamples = 100, resp = "TrustFamily")
# 
# loo_compare(loo(m3), loo(m3_mv))



##m4 <- brm(
  ##Main.resp. ~ 1 + Active dev. + Days.a.week + Hours.a.day,
  ##family = cumulative(),
  ##data = d
##)


```

# Results